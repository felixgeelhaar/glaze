import { Meta } from '@storybook/addon-docs';

<Meta title="Guidelines/Accessibility" />

# Accessibility Guide

The Glaze Design System is built with accessibility as a core principle, targeting WCAG 2.2 AA+ compliance.

## Core Principles

### 1. Perceivable
Information and UI components must be presentable in ways users can perceive.

- **Text Alternatives**: All non-text content has text alternatives
- **Color Contrast**: Minimum 4.5:1 for normal text, 3:1 for large text
- **Adaptable**: Content can be presented without losing meaning
- **Distinguishable**: Foreground is easy to distinguish from background

### 2. Operable
Interface components must be operable by all users.

- **Keyboard Accessible**: All functionality available via keyboard
- **No Keyboard Traps**: Users can navigate away from any component
- **Timing Adjustable**: Users can control time limits
- **Seizure Safe**: No content causes seizures

### 3. Understandable
Information and UI operation must be understandable.

- **Readable**: Text is readable and understandable
- **Predictable**: Pages appear and operate predictably
- **Input Assistance**: Help users avoid and correct mistakes
- **Consistent**: Navigation and identification are consistent

### 4. Robust
Content must be robust enough for various assistive technologies.

- **Valid Code**: Well-formed, valid HTML
- **Name, Role, Value**: All UI components expose these to assistive tech
- **Status Messages**: Important messages are announced to screen readers

## Component-Specific Guidelines

### Buttons

```html
<!-- ✅ Good: Descriptive label -->
<glz-button aria-label="Save document">
  <svg>...</svg> Save
</glz-button>

<!-- ❌ Bad: No accessible name -->
<glz-button>
  <svg>...</svg>
</glz-button>
```

**Requirements:**
- Minimum 44x44px touch target
- Focus indicator visible
- Disabled state communicated
- Loading state announced

### Forms

```html
<!-- ✅ Good: Labeled input with error -->
<glz-input 
  label="Email Address"
  type="email"
  required
  aria-describedby="email-error"
  aria-invalid="true"
>
  <span id="email-error" role="alert">
    Please enter a valid email
  </span>
</glz-input>
```

**Requirements:**
- All inputs have labels
- Required fields marked
- Errors associated with fields
- Instructions provided before input
- Success/error states announced

### Dialogs

```html
<!-- ✅ Good: Accessible dialog -->
<glz-dialog
  open
  aria-labelledby="dialog-title"
  aria-describedby="dialog-desc"
>
  <h2 id="dialog-title">Confirm Action</h2>
  <p id="dialog-desc">Are you sure you want to proceed?</p>
</glz-dialog>
```

**Requirements:**
- Focus trapped within dialog
- Focus returns on close
- Escape key closes
- Background made inert
- Title announced on open

### Navigation

```html
<!-- ✅ Good: Accessible navbar -->
<glz-navbar aria-label="Main navigation">
  <a href="#main" class="skip-link">Skip to main content</a>
  <nav role="navigation">
    <a href="/" aria-current="page">Home</a>
    <a href="/about">About</a>
  </nav>
</glz-navbar>
```

**Requirements:**
- Skip links for keyboard users
- Current page indicated
- Mobile menu keyboard accessible
- Landmark roles used
- Focus order logical

## Keyboard Navigation

### Standard Keys

| Key | Action |
|-----|--------|
| `Tab` | Move focus forward |
| `Shift + Tab` | Move focus backward |
| `Enter` | Activate button/link |
| `Space` | Toggle checkbox, activate button |
| `Escape` | Close dialog/dropdown |
| `Arrow Keys` | Navigate within components |

### Component Patterns

**Roving Tabindex** (Radio groups, tabs):
- One tab stop for group
- Arrow keys navigate within
- Home/End for first/last

**Focus Trap** (Dialogs, dropdowns):
- Tab cycles within component
- Escape closes and returns focus
- No focus outside trap

## Screen Reader Support

### ARIA Attributes

```html
<!-- Live Regions -->
<div aria-live="polite" aria-atomic="true">
  Status updates announced here
</div>

<!-- Descriptions -->
<glz-input
  aria-label="Search"
  aria-describedby="search-help"
/>
<span id="search-help">Press Enter to search</span>

<!-- States -->
<glz-button
  aria-pressed="true"
  aria-expanded="false"
  aria-busy="true"
>
  Loading...
</glz-button>
```

### Announcements

The system includes a centralized `LiveAnnouncer`:

```javascript
import { LiveAnnouncer } from '@glaze/components';

const announcer = LiveAnnouncer.getInstance();
announcer.announce('Form submitted successfully', 'polite');
announcer.announce('Error: Invalid input', 'assertive');
```

## Visual Preferences

### Reduced Motion

```css
/* Automatically applied to all components */
@media (prefers-reduced-motion: reduce) {
  * {
    animation-duration: 0.01ms !important;
    transition-duration: 0.01ms !important;
  }
}
```

### Reduced Transparency

```css
/* Glass effects become solid */
@media (prefers-reduced-transparency: reduce) {
  .glass {
    backdrop-filter: none;
    background: var(--color-surface-base);
    opacity: 0.98;
  }
}
```

### High Contrast

```html
<!-- Use high contrast theme -->
<body data-theme="high-contrast">
  <!-- Increased contrast ratios -->
  <!-- Solid backgrounds -->
  <!-- Stronger borders -->
</body>
```

### Dark Mode

```html
<!-- Respect system preference -->
<body data-theme="auto">
  <!-- Follows prefers-color-scheme -->
</body>
```

## Testing Tools

### Automated Testing

```javascript
// In your tests
import { axe } from '@axe-core/playwright';

test('should be accessible', async ({ page }) => {
  await page.goto('/');
  const results = await axe(page);
  expect(results.violations).toHaveLength(0);
});
```

### Manual Testing

1. **Keyboard Testing**
   - Unplug your mouse
   - Navigate using only keyboard
   - Verify all interactive elements reachable
   - Check focus indicators visible

2. **Screen Reader Testing**
   - NVDA (Windows): Free
   - JAWS (Windows): Commercial
   - VoiceOver (macOS): Built-in
   - Orca (Linux): Free

3. **Color Contrast**
   - Chrome DevTools contrast checker
   - Stark (Figma plugin)
   - WebAIM contrast checker

4. **Browser Extensions**
   - axe DevTools
   - WAVE
   - Lighthouse

## Common Issues and Fixes

### Issue: Missing Focus Indicators
```css
/* ✅ Fix: Ensure visible focus */
:focus-visible {
  outline: 2px solid var(--color-primary-base);
  outline-offset: 2px;
}
```

### Issue: Color-Only Information
```html
<!-- ❌ Bad: Color only -->
<span class="red">Required</span>

<!-- ✅ Good: Multiple indicators -->
<span class="red" aria-label="Required field">
  * Required
</span>
```

### Issue: Decorative Images
```html
<!-- ❌ Bad: Meaningless alt -->
<img src="decoration.jpg" alt="image">

<!-- ✅ Good: Empty alt for decoration -->
<img src="decoration.jpg" alt="" role="presentation">
```

### Issue: Click Handlers on Divs
```html
<!-- ❌ Bad: Not keyboard accessible -->
<div onclick="doSomething()">Click me</div>

<!-- ✅ Good: Use button -->
<button onclick="doSomething()">Click me</button>
```

## Accessibility Checklist

Before releasing any component:

- [ ] **Keyboard**: Fully keyboard navigable
- [ ] **Screen Reader**: All content announced properly
- [ ] **Focus**: Focus indicators visible and logical
- [ ] **Color**: 4.5:1 contrast ratio minimum
- [ ] **Motion**: Respects reduced motion preference
- [ ] **Transparency**: Has reduced transparency fallback
- [ ] **Touch**: 44x44px minimum touch targets
- [ ] **Errors**: Form errors clearly communicated
- [ ] **Loading**: Loading states announced
- [ ] **Language**: Plain language used
- [ ] **Structure**: Semantic HTML used
- [ ] **Testing**: Passes axe-core audit

## Resources

- [WCAG 2.2 Guidelines](https://www.w3.org/WAI/WCAG22/quickref/)
- [ARIA Authoring Practices](https://www.w3.org/WAI/ARIA/apg/)
- [WebAIM Resources](https://webaim.org/resources/)
- [A11y Project Checklist](https://www.a11yproject.com/checklist/)
- [Inclusive Components](https://inclusive-components.design/)

Remember: **Accessibility is not optional**. It's a fundamental requirement for quality software.